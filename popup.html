<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header">
        <div class="logo">
            <span style="font-size: 13px;">NucuaNheo</span>
        </div>
    </div>

    <div class="container" style="padding: 16px;">
        <!-- Status Message Area -->
        <div id="status-area" class="status-msg"></div>

        <!-- VIEW 1: DATA SOURCE -->
        <div id="view-source" class="fade-in">
            <div class="tabs">
                <div class="tab active" data-tab="scan">Scan Sheet</div>
                <div class="tab" data-tab="api">Script API</div>
                <div class="tab" data-tab="ai">AI Config</div>
            </div>

            <!-- Method: Direct Scan -->
            <div id="tab-scan" class="tab-content">
                <!-- Section A: Active Browser Tab -->
                <div class="card" style="margin-bottom: 6px;">
                    <div class="label">Scan Active Browser Tab</div>
                    <p style="font-size:12px; color:#64748b; margin-bottom:8px;">
                        Use the Google Sheet currently open in your browser.
                    </p>
                    <button id="btn-scan" class="btn btn-secondary" style="font-size:13px; padding:8px;">
                        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <path d="M3 3h18v18H3z"></path>
                            <path d="M3 9h18M9 21V9"></path>
                        </svg>
                        Scan Current Page
                    </button>
                </div>

                <!-- Section B: Remote Sheets from Script -->
                <div id="remote-sheets-area">
                    <div class="card">
                        <div class="label" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>Select Connected Sheet</span>
                            <span id="refresh-sheets"
                                style="cursor:pointer; color:#be123c; font-size:11px;">Refresh</span>
                        </div>

                        <div id="not-connected-msg" class="hidden" style="margin-bottom:8px;">
                            <p style="font-size:12px; color:#dc2626;">Script not connected.</p>
                            <button id="btn-goto-api" class="btn btn-primary"
                                style="padding:6px; font-size:12px;">Connect Script</button>
                        </div>

                        <div id="sheet-selector-container">
                            <input type="text" id="search-sheets" placeholder="Search tabs..."
                                style="margin-bottom:10px; font-size:12px;">
                            <div id="sheet-list"
                                style="max-height:300px; overflow-y:auto; display:flex; flex-direction:column; gap:6px;">
                                <div style="font-size:12px; color:#64748b; text-align:center; padding:10px;">
                                    No sheets loaded. Connect in "Script API" tab.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Method: API Config -->
            <div id="tab-api" class="tab-content hidden">
                <!-- Connection Settings -->
                <div id="api-step-connect">
                    <div class="card">
                        <div class="label">Configuration</div>
                        <label style="display:block; margin-bottom:6px; font-size:12px; color:#64748b;">Google Apps
                            Script URL</label>
                        <input type="text" id="script-url" class="input-field"
                            placeholder="https://script.google.com/..."
                            value="https://script.google.com/macros/s/AKfycbwfPJi85P3mHAaUf1rI0GxAO4TEHvjkFFKK1qnGfQLNjDjqkylQfq4wVfmF1lei9yB4lw/exec">

                        <button id="btn-connect" class="btn btn-primary" style="margin-top:12px;">
                            Update Connection
                        </button>
                        <div style="text-align:center; font-size:11px; margin-top:8px; opacity:0.6; cursor:pointer;"
                            id="link-help">How to setup Script?</div>
                    </div>
                </div>
            </div>

            <!-- Method: AI Config -->
            <div id="tab-ai" class="tab-content hidden">
                <div class="card">
                    <div class="label">Gemini Settings</div>

                    <div style="margin-bottom:10px;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">API Key</div>
                        <div style="position:relative;">
                            <input type="password" id="ai-api-key" class="input-field"
                                value="AIzaSyB1Zm-X4j17iDHwYzjw4w5zKEBMT7wtaDg" placeholder="Enter Gemini API Key"
                                style="padding-right:30px;">
                            <span id="toggle-ai-key"
                                style="position:absolute; right:8px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:0.5;">
                                üëÅÔ∏è
                            </span>
                        </div>
                    </div>

                    <div style="margin-bottom:10px;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Model</div>
                        <select id="ai-model" class="input-field"
                            style="background:#ffffff; color:#334155; border:1px solid #ffd2d3;">
                            <option value="gemini-3-flash-preview">Gemini 3 Flash (Preview)</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        </select>
                    </div>

                    <div style="margin-bottom:10px;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Prompt Template</div>
                        <textarea id="ai-prompt"
                            style="width:100%; height:300px; background:#ffffff; color:#334155; border:1px solid #ffd2d3; padding:8px; border-radius:4px; font-size:11px; resize:vertical;">based on the attached this .... and Based on Etsy‚Äôs Seller Handbook update from August 22, 2025, help me write an optimized SEO etsy title:
Clearly state the item for sale, like ‚Äúmug‚Äù or ‚Äúdress‚Äù
Include the most important traits upfront, like your item‚Äôs color, material, and size
Streamline for clarity and scannability. Consider using less than 15 words when including the traits that make your item special.
Only include holidays, special occasions, or recipient types if they‚Äôre essential to what the item is, like ‚Äúbirthday candle‚Äù or ‚ÄúHalloween costume‚Äù
Move subjective words, like ‚Äúperfect‚Äù or ‚Äúbeautiful,‚Äù to the description
Try not to repeat words
Don‚Äôt worry about adding info about price, shipping, or sales. Etsy helps take care of this by badging your items in Search.
 and 13 seo tags for this. All Tags are limited to 20 characters for each tag and separated by commas , verify the wordmark, trademark, and copyright status of this item</textarea>
                    </div>

                    <button id="btn-save-ai" class="btn btn-primary">Save AI Settings</button>

                    <div style="margin-top:12px; border-top:1px solid #ffd2d3; padding-top:10px;">
                        <div style="font-size:12px; color:#b33737; display:flex; align-items:center; gap:8px;">
                            <input type="checkbox" id="ai-auto-trigger" checked>
                            <label for="ai-auto-trigger">Auto-generate on Image Upload</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Check if data already exists -->
            <div id="existing-data-alert" class="card hidden" style="margin-top:12px; border-color: #f59e0b;">
                <div style="font-size:13px; color:#f59e0b; margin-bottom:8px;">Data already in memory</div>
                <button id="btn-use-existing" class="btn btn-secondary" style="font-size:12px; padding:8px;">Continue to
                    Mapping</button>
            </div>
        </div>

        <!-- VIEW 2: MAPPING -->
        <div id="view-mapping" class="fade-in hidden">
            <div class="card">
                <div class="label">Source Data</div>
                <div id="data-source-name" style="font-size:14px; color:#334155; margin-bottom:12px; font-weight:600;">
                    ...
                </div>

                <div class="label">Variant Column 1</div>
                <select id="select-variant-1"></select>

                <div class="label" style="margin-top:12px;">Variant Column 2 <span
                        style="font-size:10px; opacity:0.6; font-weight:400">(Optional)</span></div>
                <select id="select-variant-2">
                    <option value="">-- None --</option>
                </select>

                <div class="label" style="margin-top:12px;">Price Column</div>
                <select id="select-price"></select>

                <div class="label" style="margin-top:12px;">Description <span
                        style="font-size:10px; opacity:0.6; font-weight:400">(Optional - Auto-detected)</span></div>
                <select id="select-description">
                    <option value="">-- Scanning for descriptions... --</option>
                </select>
                <div id="description-preview"
                    style="font-size:11px; color:#64748b; margin-top:4px; font-style:italic; max-height:60px; overflow-y:auto;">
                </div>

                <!-- Pricing Logic -->
                <div class="label" style="margin-top:16px; border-top:1px solid #ffd2d3; padding-top:12px;">Pricing
                    Calculation</div>

                <div style="display:flex; gap:10px; margin-bottom: 8px;">
                    <div style="flex:1;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Discount Markup</div>
                        <select id="select-discount" style="font-size:13px;">
                            <option value="0">None (Price as-is)</option>
                            <option value="0.2">20% Off</option>
                            <option value="0.25">25% Off</option>
                            <option value="0.3">30% Off</option>
                            <option value="0.4">40% Off</option>
                            <option value="0.5">50% Off</option>
                            <option value="0.6">60% Off</option>
                            <option value="0.7">70% Off</option>
                            <option value="custom">Custom %</option>
                        </select>
                        <input type="number" id="input-custom-discount" placeholder="e.g. 15" class="hidden"
                            style="width:100%; margin-top:4px; font-size:13px;">
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Original Currency</div>
                        <select id="select-currency-from" disabled style="background:#f1f5f9; color:#94a3b8;">
                            <option value="USD" selected>USD (Sheet)</option>
                        </select>
                    </div>
                    <div style="flex:1;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Target Currency</div>
                        <select id="select-currency-to" style="font-size:13px;">
                            <option value="USD">USD (No Convert)</option>
                            <option value="NZD">NZD (New Zealand)</option>
                            <option value="AUD">AUD (Australia)</option>
                            <option value="CAD">CAD (Canada)</option>
                            <option value="GBP">GBP (British Pound)</option>
                            <option value="EUR">EUR (Euro)</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex; gap:10px; margin-top:8px;">
                    <div style="flex:1;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Rounding / Ending</div>
                        <select id="select-rounding" style="font-size:13px;">
                            <option value="none">Standard (2 decimals)</option>
                            <option value="99">End with .99</option>
                            <option value="95">End with .95</option>
                            <option value="00">Round to .00</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex; gap:10px; margin-top:8px;">
                    <div style="flex:1;">
                        <div style="font-size:11px; color:#64748b; margin-bottom:4px;">Custom Rate (Optional)</div>
                        <input type="number" id="input-custom-rate" placeholder="Auto" step="0.001"
                            style="width:100%; font-size:13px; background:#ffffff; color:#334155; border:1px solid #ffd2d3; padding:6px; border-radius:4px;">
                    </div>
                </div>
            </div>

            <div style="display:flex; gap:8px; margin-top:8px;">
                <button id="btn-apply" class="btn btn-primary"
                    style="flex:1; justify-content:center; padding-left:4px; padding-right:4px;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M13 10l5 5m0 0l-5 5m5-5H6"></path>
                    </svg>
                    Apply
                </button>

                <button id="btn-update-price" class="btn"
                    style="flex:1; justify-content:center; background: #fff0f0; color: #881337; border: 1px solid #ffd2d3; padding-left:4px; padding-right:4px;">
                    Update Prices
                </button>
            </div>
            <button id="btn-back" class="btn btn-secondary" style="margin-top:8px;">Back</button>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="modal-help" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="close-help" class="modal-close">‚úï</div>
            <h3 style="color:#be123c; margin:0 0 12px 0;">Setup Google Script</h3>
            <p style="font-size:13px; line-height:1.5; color:#475569;">
                1. Create a Google Sheet.<br>
                2. Extensions > Apps Script.<br>
                3. Paste the code below.<br>
                4. Deploy > New Deployment > Web App > Everyone.<br>
                5. Copy the URL.
            </p>
            <textarea id="gs-code" readonly></textarea>
            <button id="btn-copy-code" class="btn btn-secondary"
                style="margin-top:12px; font-size:12px; padding:8px;">Copy Code</button>
        </div>
    </div>

    <!-- Marquee Footer -->
    <div class="marquee-container">
        <div class="marquee-text">TOI DAM LAM BAN CO DAM KHONG &nbsp;&nbsp;‚Ä¢&nbsp;&nbsp; NEU BAN DAM TOI CUNG VAY
        </div>
    </div>

    <script src="popup.js"></script>
</body>

</html>